Some of these routines are based on John Canik's g3d idl routines.